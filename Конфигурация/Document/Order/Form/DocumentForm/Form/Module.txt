
&AtClient
Procedure OnOpen(Cancel)
    
    OnOpenServer();

EndProcedure

Procedure OnOpenServer()

	If IsInRole("Admin") = False Then
        ThisForm.Items.Visit.ReadOnly = True;
        ThisForm.Items.Outlet.ReadOnly = True;
        ThisForm.Items.SR.ReadOnly = True;
        ThisForm.Items.SKUs.ChangeRowSet=False;
    EndIf;    

EndProcedure

&AtClient
Procedure SKUsSKUOnChange(Item)
	Str = Items.SKUs.CurrentData;
	Str.Price = GetSKUPrice(Str.SKU);	
	GetAmount();
EndProcedure

&AtServer
Function GetSKUPrice(SKU)
	Return SKU.Price;	
EndFunction

&AtClient
Procedure GetAmount()
	Str = Items.SKUs.CurrentData;
	Str.Total = Str.Price*(Str.Discount/100+1);
    Str.Amount = Str.Total*Str.Qty;
EndProcedure

&AtClient
Procedure SKUsQtyOnChange(Item)
	GetAmount();
EndProcedure

&AtClient
Procedure SKUsPriceOnChange(Item)
	GetAmount();
EndProcedure

&AtClient
Procedure SKUsDiscountOnChange(Item)
    GetAmount();
EndProcedure

&AtClient
Procedure SKUsTotalOnChange(Item)
    GetAmount();
EndProcedure


