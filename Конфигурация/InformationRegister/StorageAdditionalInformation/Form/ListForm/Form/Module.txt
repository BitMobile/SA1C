
&AtClient
Procedure ListOnActivateRow(Item)
	
	If ShowPreview Then
		
		ShowPreview();
		
	EndIf;	
	
EndProcedure

&AtServer
Procedure ShowPreview()
	
	If ValueIsFilled(Items.List.CurrentRow) Then 
	
		RecordManager = InformationRegisters.StorageAdditionalInformation.CreateRecordManager();
		
		FillPropertyValues(RecordManager, Items.List.CurrentRow);
		
		RecordManager.Read();
		
		BinaryDataOfFile = RecordManager.Storage.Get();
		
		If ValueIsFilled(BinaryDataOfFile) Then 
		
			Preview = PutToTempStorage(BinaryDataOfFile, ThisForm.UUID);
			
		Else 
			
			Password 	= Constants.bitmobile_Пароль.Get();
			Server 		= StrReplace(Constants.bitmobile_Сервер.Get(), "localhost", "127.0.0.1");
			Path 		= Constants.bitmobile_ПутьНаСервере.Get();
			Path 		= StrReplace(Path, "admin", "webdav");
			Port 		= Constants.bitmobile_Порт.Get();
			
			Try
	
				Connection = New HTTPConnection(Server, Port, "admin", Password);
				
			Except
				
				Connection = Undefined;
				
			EndTry;
			
			If Not Connection = Undefined Then 
			
				Try
					
					WebDAVFile = GetTempFileName(RecordManager.Extension);
					
					Connection.Get(Path + RecordManager.FullFileName, WebDAVFile);
					
					BinaryDataOfFile = New BinaryData(WebDAVFile);
					
					Preview = PutToTempStorage(BinaryDataOfFile, ThisForm.UUID);
										
				Except
				EndTry;
				
			EndIf;
			
		EndIf;
		
	EndIf;
		
EndProcedure
 
&AtClient
Procedure ShowPreviewOnChange(Item)
	
	If ShowPreview Then
		
		ShowPreview();
		
	Else 
		
		Preview = Undefined;
		
	EndIf;	
	
EndProcedure

&AtClient
Procedure SetSizeOfFiles(Command)
	
	SetSizeOfFilesServer();
	
	Items.List.Refresh();
	
EndProcedure

&AtServer
Procedure SetSizeOfFilesServer()
	
	TempFile 	= GetTempFileName();
	
	RecordSet = InformationRegisters.StorageAdditionalInformation.CreateRecordSet();
	RecordSet.Read();
	
	For Each Str in RecordSet Do 
		
		BinaryData 	= Str.Storage.Get();
		
		If ValueIsFilled(BinaryData) Then 
		
			BinaryData.Write(TempFile);
			
			CheckFileSize = New File(TempFile);
			
			Str.Size = CheckFileSize.Size();
			
		EndIf;	
		
	EndDo;
	
	RecordSet.Write();
	
EndProcedure