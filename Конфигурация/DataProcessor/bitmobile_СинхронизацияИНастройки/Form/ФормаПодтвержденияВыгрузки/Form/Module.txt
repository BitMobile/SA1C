
/////////////////////////////////////////////////////////////////////////////////////////////////
// Процедуры и функции для обеспечения синхронизации файлов

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВсеДокументы 	= Истина;
	ВсеСправочники 	= Истина;
	
КонецПроцедуры

/////////////////////////////////////////////////////////////////////////////////////////////////
// Общие процедуры и функции

&НаСервереБезКонтекста
Процедура ВыгрузитьДанныеВФайлСервер(ВсеДанные, АдресВХ, ИмяФайла, ВыбраннаяНастройка, ТекстВидОбъекта)
	
	Обработки.bitmobile_СинхронизацияИНастройки.ВыгрузитьДанные(ВсеДанные, Истина, АдресВХ, ВыбраннаяНастройка, ТекстВидОбъекта);
		
КонецПроцедуры

/////////////////////////////////////////////////////////////////////////////////////////////////
// Командный интерфейс

&НаКлиенте
Процедура ИмяФайлаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
#Если ВебКлиент Тогда 
	
	ИмяВыбранногоФайла = "";
	
	ПоместитьФайл( , ИмяВыбранногоФайла, ИмяВыбранногоФайла, Истина, ЭтаФорма.УникальныйИдентификатор); 
	
	Если ЗначениеЗаполнено(ИмяВыбранногоФайла) Тогда 
			
		ИмяФайла = ИмяВыбранногоФайла;
		
	КонецЕсли;
	
#Иначе
	
	Диалог 						= Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.Заголовок 			= "Выберите файл";
	Диалог.ПолноеИмяФайла 		= ""; 
	Диалог.Фильтр 				= "XML файл(*.xml)|*.xml";
	Диалог.МножественныйВыбор 	= Ложь;
			
	Если Диалог.Выбрать() Тогда 
		
		ИмяФайла = Диалог.ПолноеИмяФайла;
						
	КонецЕсли;
	
#КонецЕсли	
	
КонецПроцедуры

&НаКлиенте
Процедура Выгрузить(Команда)
	
	Если ЗначениеЗаполнено(ИмяФайла) Тогда 
	
		АдресВХ = "";
				
		ВыгрузкаЗавершена = Ложь;
		
		НастройкаКПередаче = Неопределено;

		ТекстВидОбъекта = "";
		
		Если Не ВсеДокументы И Не ВсеСправочники И Не ЗначениеЗаполнено(Настройка) Тогда 
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Не указаны параметры выгрузки.";
			Сообщение.Сообщить();
			
			Возврат;
			
		ИначеЕсли Не ВсеДокументы И Не ВсеСправочники И ЗначениеЗаполнено(Настройка) Тогда
			
			НастройкаКПередаче = Настройка;
			
		ИначеЕсли Не ВсеДокументы И ВсеСправочники И Не ЗначениеЗаполнено(Настройка) Тогда	
			
			ТекстВидОбъекта = "Catalog";
			
		ИначеЕсли ВсеДокументы И Не ВсеСправочники И Не ЗначениеЗаполнено(Настройка) Тогда	
			
			ТекстВидОбъекта = "Document";	
			
		КонецЕсли;	
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Выгрузка данных в процессе...";
		Сообщение.Сообщить();
		
		ВыгрузитьДанныеВФайлСервер(Истина, АдресВХ, ИмяФайла, НастройкаКПередаче, ТекстВидОбъекта);
		
		Если ЗначениеЗаполнено(АдресВХ) Тогда  
			
			ПолучитьФайл(АдресВХ, ИмяФайла, Ложь);
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Файл: " + ИмяФайла;
			Сообщение.Сообщить();
			
		КонецЕсли;
		
	Иначе 
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Не указан файл.";
		Сообщение.Сообщить();
		
	КонецЕсли;
			
КонецПроцедуры

&НаКлиенте
Процедура ЗакрытьФорму(Команда)
	
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ВсеДокументыПриИзменении(Элемент)
	
	Если ВсеДокументы Тогда 
		
		Настройка = Неопределено;
		
	КонецЕсли;
		
КонецПроцедуры

&НаКлиенте
Процедура ВсеСправочникиПриИзменении(Элемент)
	
	Если ВсеСправочники Тогда 
		
		Настройка = Неопределено;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура НастройкаПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(Настройка) Тогда 
		
		ВсеДокументы 	= Ложь;
		ВсеСправочники 	= Ложь;
		
	КонецЕсли;
		
КонецПроцедуры




