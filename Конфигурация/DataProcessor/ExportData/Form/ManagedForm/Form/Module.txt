
&AtServer
Procedure UploadDataInFileServer(All, UploadComplete, TempStorageAddress, FileName)
	
	Message(NStr("en = ""Data upload is in process..""; ru = ""Выгрузка данных в процессе..."""), MessageStatus.Important); 
	
	DataProcessors.SyncAndSettings.UploadData(All, UploadComplete, True, TempStorageAddress);
		
	If UploadComplete Then
		
		Message(NStr("en = ""Data upload completed. File: " + FileName + """; ru = ""Выгрузка данных завершена. Файл: " + FileName + """"));
		DataProcessors.SyncAndSettings.SaveSyncState(True);
					
	Else 
		
		Message(NStr("en = ""Data upload interrupted""; ru = ""Выгрузка данных прервана"""));
		DataProcessors.SyncAndSettings.SaveSyncState(False);
		
	EndIf;
	
EndProcedure	

&AtServer
Procedure ExportMetadataServer(TempStorageAddress)
	
	ProcessorObject = FormAttributeToValue("Object");
    ProcessorObject.ExportMetadata(TempStorageAddress);
	 
EndProcedure

&AtClient
Procedure ExportMetadata(Command)

	Dialog = New FileDialog(FileDialogMode.Open);
	Dialog.Title = NStr("en = ""Select file""; ru = ""Выберите файл""");
	Dialog.FullFileName = ""; 
	Filter = NStr("en = ""XML file(*.xml)|*.xml""; ru = ""XML файл(*.xml)|*.xml"""); 
	Dialog.Filter = Filter; 
	Dialog.Multiselect = False;
		
	If Dialog.Choose() Then
		
		TempStorageAddress = "";
		
		ExportMetadataServer(TempStorageAddress);
		
		GetFile(TempStorageAddress,	Dialog.FullFileName, False);
		
	EndIf;
    
EndProcedure

&AtClient
Procedure UploadDataInFile(Command)
	
	Mode = QuestionDialogMode.OKCancel;
	
	Text = "en = 'The operation can take a long time and will start immediately after selecting the file. Continue?';"
		 + "ru = 'Операция может занять продолжительное время и начнется сразу после выбора файла. Продолжить?'";
	
	Answer = DoQueryBox(NStr(Text), Mode, 0);
	
	If Answer = DialogReturnCode.OK Then
	
		Dialog = New FileDialog(FileDialogMode.Open);
		Dialog.Title = NStr("en = ""Select file""; ru = ""Выберите файл""");
		Dialog.FullFileName = ""; 
		Filter = NStr("en = ""XML file(*.xml)|*.xml""; ru = ""XML файл(*.xml)|*.xml"""); 
		Dialog.Filter = Filter; 
		Dialog.Multiselect = False;
				
		If Dialog.Choose() Then
			
			TempStorageAddress = "";
			
			UploadComplete = False;
			
			UploadDataInFileServer(True, UploadComplete, TempStorageAddress, Dialog.FullFileName);
			
			If UploadComplete Then 
				
				GetFile(TempStorageAddress,	Dialog.FullFileName, False);
				
			EndIf;
							
		EndIf;
				
	EndIf;
		
EndProcedure

&AtClient
Procedure OnOpen(Cancel)
	
	#If WebClient Then
		
		Text = "ru = ""Обработка не предназначена для открытия в веб-клиенте.""; en = ""Processing is not intended to open a Web client.""";
		DoMessageBox(NStr(Text), 10);
		Cancel = True;
		
	#EndIf	
	
EndProcedure
